{"ast":null,"code":"import _regeneratorRuntime from \"/home/leonardo/Documentos/Projetos-Clone/ignews/node_modules/@babel/runtime/regenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _asyncToGenerator from \"/home/leonardo/Documentos/Projetos-Clone/ignews/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/leonardo/Documentos/Projetos-Clone/ignews/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/leonardo/Documentos/Projetos-Clone/ignews/src/components/SubscribeButton/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { useSession, signIn } from 'next-auth/client';\nimport styles from './styles.module.scss';\nimport { api } from '../../services/api';\nimport { getStripeJs } from '../../services/stripe-js';\nexport function SubscribeButton(_ref) {\n  _s();\n\n  var priceId = _ref.priceId;\n\n  var _useSession = useSession(),\n      _useSession2 = _slicedToArray(_useSession, 1),\n      session = _useSession2[0];\n\n  function handleSubscribe() {\n    return _handleSubscribe.apply(this, arguments);\n  }\n\n  function _handleSubscribe() {\n    _handleSubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var response, sessionId, stripe;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (session) {\n                _context.next = 3;\n                break;\n              }\n\n              signIn('github');\n              return _context.abrupt(\"return\");\n\n            case 3:\n              _context.prev = 3;\n              _context.next = 6;\n              return api.post('/subscribe');\n\n            case 6:\n              response = _context.sent;\n              sessionId = response.data.sessionId;\n              _context.next = 10;\n              return getStripeJs();\n\n            case 10:\n              stripe = _context.sent;\n              _context.next = 13;\n              return stripe.redirectToCheckout({\n                sessionId: sessionId\n              });\n\n            case 13:\n              _context.next = 18;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](3);\n              console.log(_context.t0.message);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 15]]);\n    }));\n    return _handleSubscribe.apply(this, arguments);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: handleSubscribe,\n    className: styles.subscribeButton,\n    type: \"button\",\n    children: \"Subscribe Now\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 33,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SubscribeButton, \"Vxy5gMemEU/s8dbgarDyE2/t+kg=\", false, function () {\n  return [useSession];\n});\n\n_c = SubscribeButton;\n\nvar _c;\n\n$RefreshReg$(_c, \"SubscribeButton\");","map":{"version":3,"sources":["/home/leonardo/Documentos/Projetos-Clone/ignews/src/components/SubscribeButton/index.tsx"],"names":["useSession","signIn","styles","api","getStripeJs","SubscribeButton","priceId","session","handleSubscribe","post","response","sessionId","data","stripe","redirectToCheckout","console","log","message","subscribeButton"],"mappings":";;;;;;;;AAAA,SAASA,UAAT,EAAqBC,MAArB,QAAmC,kBAAnC;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,SAASC,GAAT,QAAoB,oBAApB;AACA,SAASC,WAAT,QAA4B,0BAA5B;AAMA,OAAO,SAASC,eAAT,OAA4D;AAAA;;AAAA,MAAjCC,OAAiC,QAAjCA,OAAiC;;AAAA,oBAC/CN,UAAU,EADqC;AAAA;AAAA,MAC1DO,OAD0D;;AAAA,WAGlDC,eAHkD;AAAA;AAAA;;AAAA;AAAA,gFAGjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACOD,OADP;AAAA;AAAA;AAAA;;AAEIN,cAAAA,MAAM,CAAC,QAAD,CAAN;AAFJ;;AAAA;AAAA;AAAA;AAAA,qBAO2BE,GAAG,CAACM,IAAJ,CAAS,YAAT,CAP3B;;AAAA;AAOUC,cAAAA,QAPV;AAQYC,cAAAA,SARZ,GAQ0BD,QAAQ,CAACE,IARnC,CAQYD,SARZ;AAAA;AAAA,qBASyBP,WAAW,EATpC;;AAAA;AASUS,cAAAA,MATV;AAAA;AAAA,qBAWUA,MAAM,CAACC,kBAAP,CAA0B;AAACH,gBAAAA,SAAS,EAATA;AAAD,eAA1B,CAXV;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAcII,cAAAA,OAAO,CAACC,GAAR,CAAY,YAAMC,OAAlB;;AAdJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAHiE;AAAA;AAAA;;AAsBjE,sBACE;AACE,IAAA,OAAO,EAAET,eADX;AAEE,IAAA,SAAS,EAAEN,MAAM,CAACgB,eAFpB;AAGE,IAAA,IAAI,EAAC,QAHP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UADF;AASD;;GA/Beb,e;UACIL,U;;;KADJK,e","sourcesContent":["import { useSession, signIn } from 'next-auth/client';\nimport styles from './styles.module.scss';\nimport { api } from '../../services/api';\nimport { getStripeJs } from '../../services/stripe-js';\n\ninterface SubscribeButtonProps {\n  priceId: string;\n}\n\nexport function SubscribeButton({ priceId }: SubscribeButtonProps) {\n  const [session] = useSession();\n\n  async function handleSubscribe() {\n    if (!session) {\n      signIn('github');\n      return;\n    }\n\n    try {\n      const response = await api.post('/subscribe');\n      const { sessionId } = response.data;\n      const stripe = await getStripeJs();\n\n      await stripe.redirectToCheckout({sessionId});\n      \n    } catch (error) {\n      console.log(error.message);\n      \n    }\n  }\n\n  return (\n    <button\n      onClick={handleSubscribe}\n      className={styles.subscribeButton}\n      type=\"button\"\n    >\n      Subscribe Now\n    </button>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}